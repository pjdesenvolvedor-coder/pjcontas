{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the StreamShare application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The user's name."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The user's contact phone number."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "sellerUsername": {
          "type": "string",
          "description": "The seller's public display name in the marketplace."
        },
        "whatsappApiToken": {
          "type": "string",
          "description": "API Token for the WhatsApp service integration."
        },
        "lastSeen": {
          "type": "string",
          "description": "The last time the user was seen online.",
          "format": "date-time"
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time the user registered.",
          "format": "date-time"
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": [
            "admin",
            "customer",
            "seller"
          ]
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "registrationDate",
        "role"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a purchasable subscription plan, created by a seller.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the subscription plan (e.g., Premium)."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the subscription plan."
        },
        "price": {
          "type": "number",
          "description": "Monthly price of the subscription plan."
        },
        "sellerId": {
          "type": "string",
          "description": "Reference to the User (seller) who created this plan."
        },
        "features": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "A list of features included in the plan."
        },
        "accountModel": {
          "type": "string",
          "description": "The model of the account being sold.",
          "enum": [
            "Capturada",
            "Acesso Total"
          ]
        },
        "isBoosted": {
          "type": "boolean",
          "description": "Indicates if the subscription listing is boosted by the seller."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "sellerId",
        "features",
        "accountModel"
      ]
    },
    "UserSubscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserSubscription",
      "type": "object",
      "description": "Represents the association between a customer and a subscription plan they purchased.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user subscription entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User (customer). (Relationship: User 1:N UserSubscription)"
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription plan. (Relationship: Subscription 1:N UserSubscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Date when the user's subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the user's subscription ends.",
          "format": "date-time"
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the subscription."
        }
      },
      "required": [
        "id",
        "userId",
        "subscriptionId",
        "startDate",
        "endDate"
      ]
    },
    "Deliverable": {
      "title": "Deliverable",
      "description": "Represents an individual, sellable instance of a subscription account (e.g., login credentials).",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the deliverable item."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to the Subscription this item belongs to."
        },
        "sellerId": {
          "type": "string",
          "description": "Reference to the User (seller) who owns this item."
        },
        "content": {
          "type": "string",
          "description": "The actual content to be delivered to the buyer (e.g., 'user:pass')."
        },
        "status": {
          "type": "string",
          "description": "The current status of the deliverable item.",
          "enum": [
            "available",
            "sold"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "subscriptionId",
        "sellerId",
        "content",
        "status",
        "createdAt"
      ]
    },
    "Ticket": {
      "title": "Ticket",
      "description": "Represents a support ticket and chat conversation between a customer and a seller regarding a specific purchase.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "userSubscriptionId": {
          "type": "string",
          "description": "Reference to the UserSubscription this ticket is for."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the User (customer)."
        },
        "customerName": {
          "type": "string",
          "description": "Denormalized name of the customer for display."
        },
        "customerPhone": {
          "type": "string",
          "description": "Denormalized phone number of the customer for display."
        },
        "sellerId": {
          "type": "string",
          "description": "Reference to the User (seller)."
        },
        "sellerName": {
          "type": "string",
          "description": "Denormalized name of the seller for display."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to the Subscription plan purchased."
        },
        "planName": {
          "type": "string",
          "description": "Denormalized name of the plan for display."
        },
        "price": {
          "type": "number",
          "description": "The final price of the sale associated with this ticket."
        },
        "status": {
          "type": "string",
          "description": "The current status of the ticket.",
          "enum": [
            "open",
            "closed"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "lastMessageAt": {
          "type": "string",
          "format": "date-time"
        },
        "lastMessageText": {
          "type": "string"
        },
        "unreadBySellerCount": {
          "type": "number",
          "description": "Count of unread messages for the seller."
        },
        "unreadByCustomerCount": {
          "type": "number",
          "description": "Count of unread messages for the customer."
        }
      },
      "required": [
        "id",
        "userSubscriptionId",
        "customerId",
        "sellerId",
        "subscriptionId",
        "status",
        "createdAt",
        "price"
      ]
    },
    "ChatMessage": {
      "title": "ChatMessage",
      "description": "Represents a single message within a support ticket.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "ticketId": {
          "type": "string",
          "description": "Reference to the parent Ticket."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message."
        },
        "senderName": {
          "type": "string",
          "description": "Denormalized name of the sender for display."
        },
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "ticketId",
        "senderId",
        "text",
        "timestamp"
      ]
    },
    "Coupon": {
      "title": "Coupon",
      "description": "Represents a discount coupon that can be applied at checkout.",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The coupon code that users will enter. This is also the document ID."
        },
        "discountPercentage": {
          "type": "number",
          "description": "The discount percentage (e.g., 10 for 10%)."
        },
        "usageLimit": {
          "type": "number",
          "description": "The maximum number of times this coupon can be used. A value of 0 means unlimited."
        },
        "usageCount": {
          "type": "number",
          "description": "The number of times this coupon has been used."
        },
        "subscriptionId": {
          "type": "string",
          "description": "If set, this coupon is only valid for the specified subscription plan ID."
        },
        "subscriptionName": {
          "type": "string",
          "description": "Denormalized name of the subscription plan this coupon is for."
        }
      },
      "required": [
        "name",
        "discountPercentage"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information (customers, sellers, and admins). Path-based ownership ensures only the authenticated user can access their own data, while admins have elevated privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores all available subscription plans created by sellers. Publicly readable, but sellers can only manage their own plans.",
          "params": [
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription plan."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/userSubscriptions/{userSubscriptionId}",
        "definition": {
          "entityName": "UserSubscription",
          "schema": {
            "$ref": "#/backend/entities/UserSubscription"
          },
          "description": "Stores the subscriptions a customer has purchased. Path-based ownership ensures only the customer can access their own purchase history.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "userSubscriptionId",
              "description": "The unique identifier of the user subscription."
            }
          ]
        }
      },
      {
        "path": "/subscriptions/{subscriptionId}/deliverables/{deliverableId}",
        "definition": {
          "entityName": "Deliverable",
          "schema": {
            "$ref": "#/backend/entities/Deliverable"
          },
          "description": "Stores the individual, sellable items (e.g., account credentials) for a specific subscription plan. Only the seller who owns the parent subscription can manage these items.",
          "params": [
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription plan."
            },
            {
              "name": "deliverableId",
              "description": "The unique identifier of the deliverable item."
            }
          ]
        }
      },
      {
        "path": "/tickets/{ticketId}",
        "definition": {
          "entityName": "Ticket",
          "schema": {
            "$ref": "#/backend/entities/Ticket"
          },
          "description": "Stores all support tickets. Access is restricted to the customer and seller involved.",
          "params": [
            {
              "name": "ticketId",
              "description": "The unique identifier of the ticket."
            }
          ]
        }
      },
      {
        "path": "/tickets/{ticketId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all messages for a specific ticket. Access is restricted to the customer and seller.",
          "params": [
            {
              "name": "ticketId",
              "description": "The unique identifier of the ticket."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the message."
            }
          ]
        }
      },
      {
        "path": "/coupons/{couponId}",
        "definition": {
          "entityName": "Coupon",
          "schema": {
            "$ref": "#/backend/entities/Coupon"
          },
          "description": "Stores all available discount coupons. Publicly readable, but only writable by admins.",
          "params": [
            {
              "name": "couponId",
              "description": "The unique identifier of the coupon, often the coupon name itself."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for a marketplace model. It separates Users, Services (streaming providers), and Subscriptions (plans sold by sellers). Users can be customers, sellers, or admins, determined by their role. The `/services` collection is a catalog managed by admins. The `/subscriptions` collection is a global pool of all plans offered by all sellers. Security rules ensure that sellers can only manage their own subscriptions. Customers purchase subscriptions, which are recorded in the `/users/{userId}/userSubscriptions` subcollection, ensuring private and scalable purchase histories. The `/tickets` collection manages post-purchase communication, with access restricted to the buyer and seller of that transaction. This maintains Authorization Independence, as rules are based on user roles and document ownership (`sellerId`, `userId`, `customerId`)."
  }
}
